---
title: Ethernaut Writeups Part-2
tags:
- technology
- blockchain
image: /images/ether/info.png
---

Continuing from challenge 6 of the Ethernaut!

<!--more-->

# Delegation

In this challenge we leaarn about delete method. It is a method used to call functions of other smart contracts. Lets look at the source code:

{%highlight text%}
// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;

contract Delegate {

  address public owner;

  constructor(address _owner) public {
    owner = _owner;
  }

  function pwn() public {
    owner = msg.sender;
  }
}

contract Delegation {

  address public owner;
  Delegate delegate;

  constructor(address _delegateAddress) public {
    delegate = Delegate(_delegateAddress);
    owner = msg.sender;
  }

  fallback() external {
    (bool result,) = address(delegate).delegatecall(msg.data);
    if (result) {
      this;
    }
  }
}
{%endhighlight%}

In the first contract we have been provided a function called "pwn()". We just need to call it throught the object of the second contract's instance. We can see here that the second contract first creates an object of the delegate contract and gives it's address as the parameter.  

Next we see a fallback function where it takes our data (that we control) and passes it to the delegate function call. Now we just need to call the fallback function with the "pwn()" as data. I still can't make sense of the last "if" block. Do not fret, for I have already posted it on stackoverflow.

Luckily we don't need the last if block to pass this challenge (It took me a while to figure it out). Here is what I did:

![](https://i.imgur.com/JEF8SCi.png)

![](https://i.imgur.com/gjfCNWs.png)

Lets understand what I did. First I called the "sendTransaction()" function with only the "data" parameter so as to trigger the fallback function. Next I gave the data parameter a value.

`web3.eth.abi.encodeFunctionSignature("pwn()")`

I tried to just do `{value:"pwn()"}` but it didn't work because the delegatecall() takes the input in an encoded format. Because we are using abi (application binary interface) We need to encode and decode values to interact with it. 

[I took help from here](https://medium.com/coinmonks/delegatecall-calling-another-contract-function-in-solidity-b579f804178c)

Author's note: [Case Study](https://blog.openzeppelin.com/on-the-parity-wallet-multisig-hack-405a8c12e8f7/)

Above article represents the technique we used in this level , which was used in second biggest eth hack of all time. 